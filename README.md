# Database Layer

This module provides a lightweight, asynchronous database abstraction layer built with SQLAlchemy and Pydantic. It supports SQLite and PostgreSQL databases, offering configuration flexibility, model definitions, and a generic service layer for CRUD operations.

## Purpose
The database_layer module is designed to:
- Simplify database configuration and connection management.
- Provide a base structure for defining SQLAlchemy models.
- Offer reusable, generic services for interacting with database entities asynchronously.

## Features
- Configurable database settings via environment variables or defaults.
- Support for SQLite and PostgreSQL with asynchronous drivers (aiosqlite and asyncpg).
- Base model class with schema conversion support.
- Generic service class for adding, retrieving, and updating records.
- Asynchronous session management with SQLAlchemy's async_sessionmaker.

## Installation
Clone the repository or integrate this module into your project.

Install the required dependencies:

```bash
pip install sqlalchemy aioqlite asyncpg pydantic-settings
```
or 

```bash
uv add sqlalchemy aioqlite asyncpg pydantic-settings
```

(Optional) Set up a .env file for custom database configuration (see example below).

## Usage
### Configure the Database:
Default settings use SQLite with a local file (database.sqlite).

Customize settings by creating a .env file.

### Define Models:
Inherit from Base in core.py to create your own models in models.py.

Implement the `to_schema` method for schema conversion.

### Use Services:
Extend `BaseService` in services.py to create custom services for your models.

Use provided methods like `add`, `get`, and `update` for database operations.

### Initialize the Database:
Run `await create_database()` to create all tables defined in your models.

## Example .env File
```env
DB=postgresql
DB_DRIVER=asyncpg
DB_USER=postgres
DB_PASS=password
DB_HOST=localhost
DB_PORT=5432
DB_NAME=postgres
DB_POOL_SIZE=8
```

## Quick Start
```python
from database_layer import get_session, create_database, BaseAccount, BaseService
import asyncio

async def main():
    # Create database tables
    await create_database()

    # Example: Add a new account
    async with get_session() as session:
        account = BaseAccount(username="user1", password="pass123")
        result = await BaseService.add(session, account)
        print(result)

asyncio.run(main())
```

## Dependencies
- **SQLAlchemy**: ORM and database toolkit.
- **aiosqlite**: Asynchronous SQLite driver.
- **asyncpg**: Asynchronous PostgreSQL driver (optional, for PostgreSQL).
- **pydantic-settings**: Configuration management with environment variable support.

## Notes
- The module defaults to SQLite if no configuration is provided.
- this Readme generated by xAI.
